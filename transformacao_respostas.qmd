---
sidebar: false
title: "Transformação de dados com dplyr"
subtitle: "Soluções"
format: 
  html:
      code-link: true
      code-line-numbers: false
editor_options: 
  chunk_output_type: console
---

![](images/dplyr.png){width="102"}

### Pacotes necessários

Para fazer estes exercícios, acione os pacotes a seguir:

```{r}
#| warning: false
#| message: false
library(tidyverse)
```

### Obtenção dos dados

Para obter os dados, execute o código a seguir:

```{r}
#| message: false
#| warning: false
#| echo: false
ufo <- read_csv("./data/ufo_sightings.csv")

eventos <- read_csv("./data/noaa_data_clean.csv")
```

```{r}
#| message: false
#| warning: false
#| eval: false
ufo <- read_csv("https://tinyurl.com/ufo-avist")

eventos <- read_csv("https://tinyurl.com/noaa-clean")
```

### Exercício 1

::: callout-note
Lembre-se: do exercício 1 até o exercício 5, você vai utilizar o banco de dados `ufo_sightings.csv`
:::

Considere a coluna intitulada `reported_date_time_utc` e filtre as linhas para todos os avistamentos ocorridos após 10 de setembro de 1993[^1].

[^1]: Esta é a data de estreia da série Arquivo X.

Conte o número de avistamentos de ovnis com formato chevron por cada estado dos EUA (US) e classifique em ordem decrescente.

Qual o número de avistamentos do segundo estado dos EUA com maior número de aparições de ovnis com formato chevron?

```{r}
ufo |> 
  filter(reported_date_time_utc > ymd("1993-9-10"),
         country_code == "US",
         shape == "chevron") |> 
  count(state, sort = T)
```

**Resposta**: 84

### Exercício 2

Os avistamentos ocorrem em diversos estados dos EUA. Qual o tempo médio de duração (em horas) do estado que mais tem avistamentos de objetos com o formato cigar?

```{r}
ufo |> 
  mutate(
    dur_horas = duration_seconds/3600
  ) |>
  filter(country_code == "US",
         shape == "cigar") |>
  group_by(state) |> 
  summarise(
    n = n(),
    M = mean(dur_horas)
  ) |> 
  arrange(desc(n))
```

**Resposta**: 2,39 horas

### Exercício 3

Em qual parte do dia os avistamentos tem maior tempo de duração médio?

```{r}
ufo |> 
  drop_na(day_part) |> 
  group_by(day_part) |>
  summarise(
    M = (mean(duration_seconds, na.rm = T))
  ) |> 
  arrange(desc(M))
```

**Resposta**: night (noite)

### Exercício 4

Qual o ano com maior número de avistamentos nos EUA?

```{r}
ufo |> 
  filter(country_code == "US") |> 
  mutate(
    ano = year(reported_date_time_utc)
  ) |> 
  count(ano, sort = T)
```

**Resposta**: 2014

### Exercício 5

Qual a quinta cidade dos EUA com o maior número de avistamentos? Em qual estado ela fica localizada?

```{r}
ufo |> 
  filter(country_code == "US") |> 
  count(city, state, sort = T)
```

**Resposta**: Los Angeles no estado da Califórnia

### Exercício 6

::: callout-note
A partir deste exercício, você vai utilizar o banco de dados `noaa_data`.
:::

Em qual ano houve o maior número de pessoas feridas em decorrência de desastres naturais nos Estados Unidos? Qual tipo de evento que causou esses ferimentos?

```{r}
eventos |> 
  group_by(year, evtype) |> 
  summarise(
    total_de_ferimentos = sum(injuries)
  ) |> 
  arrange(desc(total_de_ferimentos))

```

**Resposta**: Torandos em 1974

### Exercício 7

Em qual ano houve o maior número de fatalidades em decorrência de desastres naturais nos Estados Unidos? Qual tipo de evento que causou essas mortes?

```{r}
eventos |> 
  group_by(year, evtype) |> 
  summarise(
    total_de_fatalidades = sum(fatalities)
  ) |> 
  arrange(desc(total_de_fatalidades))
```

**Resposta**: Calor excessivo (excessive heat) em 1995
