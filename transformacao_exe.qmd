---
sidebar: false
title: "Transformação de dados com dplyr"
format: 
  html:
      code-link: true
      code-line-numbers: false
editor_options: 
  chunk_output_type: console
---

## Introdução

![](images/dplyr.png){width="102"}

Neste bloco de exercícios você vai utilizar o pacote `dplyr` para responder as questões a seguir, de modo a trabalhar as seguintes habilidades:

-   Filtrar dados (`filter`)
-   Criar e modificar variáveis (`mutate`)
-   Sumariar dados (`summarise`)
-   Organizar os dados em ordem decrescente ou crescente (`arrange`)
-   Agrupar dados (`group_by`)

### Pacotes necessários

Para fazer estes exercícios, acione os pacotes a seguir:

```{r}
#| warning: false
#| message: false
library(tidyverse)
```

### Bancos de dados

Entre os exercícios 1 e 5, o banco de dados `ufo_sightings.csv` vai ser empregado. Estes dados trazem informações sobre o avistamento de objetos voadores não identificados (ovinis ou ufo, na sigla em inglês). Os dados vêm do [National UFO Reporting Center](https://nuforc.org/webreports/ndxshape.html), limpos e enriquecidos com dados da [sunrise-sunset.org](https://sunrise-sunset.org/) por [Jon Harmon](https://github.com/jonthegeek/apis/).

O livro de códigos dos dados inclui 11 variáveis:

| Variável               | Classe    | Descrição                                                                                                                                                                                                                                                                                                                                                                   |
|:--------------------------|:-----------------|:--------------------------|
| reported_date_time     | datetime  | A hora e data do avistamento, conforme aparece nos dados originais do NUFORC.                                                                                                                                                                                                                                                                                               |
| reported_date_time_utc | datetime  | A hora e data do avistamento, normalizadas para UTC.                                                                                                                                                                                                                                                                                                                        |
| posted_date            | datetime  | A data em que o avistamento foi publicado no NUFORC.                                                                                                                                                                                                                                                                                                                        |
| city                   | character | A cidade do avistamento. Alguns deles foram limpos dos dados originais.                                                                                                                                                                                                                                                                                                     |
| state                  | character | O estado, província ou divisão semelhante do avistamento.                                                                                                                                                                                                                                                                                                                   |
| country_code           | character | O código de 2 letras do país do avistamento, normalizado a partir dos dados originais.                                                                                                                                                                                                                                                                                      |
| shape                  | character | A forma da nave relatada .                                                                                                                                                                                                                                                                                                                                                  |
| reported_duration      | character | A duração relatada do evento, nas palavras da testemunha.                                                                                                                                                                                                                                                                                                                   |
| duration_seconds       | double    | A duração normalizada para segundos usando regex.                                                                                                                                                                                                                                                                                                                           |
| summary                | character | O resumo do evento relatado.                                                                                                                                                                                                                                                                                                                                                |
| has_images             | logical   | Se o avistamento possui imagens disponíveis no NUFORC.                                                                                                                                                                                                                                                                                                                      |
| day_part               | character | A parte aproximada do dia em que o avistamento ocorreu, com base na data e hora informadas, no local e nos dados de [sunrise-sunset.org.](https://sunrise-sunset.org/) A latitude e a longitude foram arredondadas para o dígito 10, e a data foi arredondada para a semana, para corresponder a pontos de tempo como "crepúsculo náutico", "nascer do sol" e "pôr do sol". |

A partir do exercício 6, o banco de dados `noaa_data` vai ser empregado. Estes dados trazem informações sobre desastres naturais nos Estados Unidos vindos do U.S. National Oceanic and Atmospheric Administration's (NOAA). A versão aqui utilizada foi limpa e simplificada, de modo que seu livro de códigos inclui 7 variáveis:

| Variável   | Classe    | Descrição                                                               |
|:--------------------------|:-----------------|:--------------------------|
| year       | double    | Ano em que ocorreu o evento                                             |
| state      | character | Sigla do estado em que o evento ocorreu                                 |
| evtype     | character | Tipo de evento                                                          |
| fatalities | double    | Número de mortes decorrentes do evento                                  |
| injuries   | double    | Número de feridos deixados pelo evento                                  |
| propdmg    | double    | Montante em dólar dos prejuízos a propriedades em decorrência do evento |
| cropdmg    | double    | Montante em dólar dos prejuízdos a plantações em decorrência do evento  |

### Obtenção dos dados

Para obter os dados, execute o código a seguir:

```{r}
#| message: false
#| warning: false
#| echo: false
ufo <- read_csv("./data/ufo_sightings.csv")

eventos <- read_csv("./data/noaa_data_clean.csv")
```

```{r}
#| message: false
#| warning: false
#| eval: false
ufo <- read_csv("https://tinyurl.com/ufo-avist")

eventos <- read_csv("https://tinyurl.com/noaa-clean")


```

### Exercício 1

::: callout-note
Lembre-se: do exercício 1 até o exercício 5, você vai utilizar o banco de dados `ufo_sightings.csv`
:::

Considere a coluna intitulada `reported_date_time_utc` e filtre as linhas para todos os avistamentos ocorridos após 10 de setembro de 1993[^1].

[^1]: Esta é a data de estreia da série Arquivo X.

Conte o número de avistamentos de ovnis com formato chevron por cada estado dos EUA (US) e classifique em ordem decrescente.

Qual o número de avistamentos do segundo estado dos EUA com maior número de aparições de ovnis com formato chevron?

::: callout-tip
```{r}
#| eval: false
ymd("1993-9-10")
```
:::

### Exercício 2

Os avistamentos ocorrem em diversos estados dos EUA. Qual o tempo médio de duração (em horas) do estado que mais tem avistamentos de objetos com o formato cigar?

### Exercício 3

Em qual parte do dia os avistamentos tem maior tempo de duração médio?

### Exercício 4

Qual o ano com maior número de avistamentos nos EUA?

::: callout-tip
```{r}
#| eval: false
year(reported_date_time_utc)
```
:::

### Exercício 5

Qual a quinta cidade dos EUA com o maior número de avistamentos? Em qual estado ela fica localizada?

### Exercício 6

::: callout-note
A partir deste exercício, você vai utilizar o banco de dados `noaa_data`.
:::

Em qual ano houve o maior número de pessoas feridas em decorrência de desastres naturais nos Estados Unidos? Qual tipo de evento que causou esses ferimentos?

### Exercício 7

Em qual ano houve o maior número de fatalidades em decorrência de desastres naturais nos Estados Unidos? Qual tipo de evento que causou essas mortes?
